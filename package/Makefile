# This is a hand-crafted Makefile. It is NOT generated by Autotools.
# As such, this Makefile is not linked with the rest of the Makefiles
# in this source tree. The main targets in this file are softwre packages.

SRC_ROOT=..
PKG_VERSION = $(shell grep AC_INIT $(SRC_ROOT)/configure.ac | cut -d',' -f2 | sed -e "s=^\s*\[==" -e "s=\]==")
 
rpm: pftool-$(PKG_VERSION).spec	
	@echo RPM for PFTOOL v$(PKG_VERSION)
	@if [ \! -e $(SRC_ROOT)/Makefile ]; then	\
		cd $(SRC_ROOT); ./configure;		\
	fi
	@if [ \! -d $(HOME)/rpmbuild/SOURCES ]; then	\
		mkdir -p $(HOME)/rpmbuild/SOURCES;	\
	fi
	cd $(SRC_ROOT); make dist-gzip; mv pftool-$(PKG_VERSION).tar.gz $(HOME)/rpmbuild/SOURCES
	rpmbuild -bb --rmspec $<

pftool-$(PKG_VERSION).spec: pftool.spec
	sed -e "s=define version [.0-9]*=define version $(PKG_VERSION)=" pftool.spec > $@

clean:
	rm -f pftool-*.spec
